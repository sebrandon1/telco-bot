name: XCrypto Lookup - Weekly Slack Report

on:
  schedule:
    # Run weekly on Sundays at 8:00 AM UTC
    - cron: '0 8 * * 0'
  workflow_dispatch:

jobs:
  xcrypto-lookup:
    runs-on: ubuntu-latest
    env:
      SHELL: /bin/bash

    steps:
      - name: Install the JQ package
        run: sudo apt-get install jq -y

      - name: Clone the telco-bot repository
        uses: actions/checkout@v6

      - name: Check if XCRYPTO_LOOKUP_GITHUB_TOKEN secret exists
        run: |
          if [ -z "${{ secrets.XCRYPTO_LOOKUP_GITHUB_TOKEN }}" ]; then
            echo "Error: XCRYPTO_LOOKUP_GITHUB_TOKEN secret is not set."
            exit 1
          fi

      - name: Login to gh cli tool
        run: echo "$XCRYPTO_GITHUB_TOKEN" | gh auth login --with-token
        env:
          XCRYPTO_GITHUB_TOKEN: ${{ secrets.XCRYPTO_LOOKUP_GITHUB_TOKEN }}

      - name: Run the xcrypto-lookup script with Slack notification
        env:
          XCRYPTO_SLACK_WEBHOOK: ${{ secrets.XCRYPTO_SLACK_WEBHOOK }}
        run: |
          echo "Running xcrypto-lookup script (weekly with issue management and Slack notification)"
          ./scripts/xcrypto-lookup.sh --create-issues


name: GolangCI-Lint Checker - Daily Update

on:
  schedule:
    # Run daily at 6:30 AM UTC (1:30 AM EST / 2:30 AM EDT)
    - cron: '30 6 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  check-golangci-lint-versions:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
      
      - name: Set up Go
        uses: actions/setup-go@v6
        with:
          go-version-file: 'go.mod'
      
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq
      
      - name: Run GolangCI-Lint version checker
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Make script executable
          chmod +x scripts/golangci-lint-checker.sh
          
          # Run without --create-issues flag to only update tracking issue
          ./scripts/golangci-lint-checker.sh
      
      - name: Upload report as artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: golangci-lint-report
          path: |
            golangci-lint-report.md
            .golangci-lint-checker*.cache
          retention-days: 7


name: XCrypto Lookup - Daily

on:
  schedule:
    # Run daily at 6:00 AM UTC (after cache updates at 5:00 AM)
    - cron: '0 6 * * *'
  workflow_dispatch:

jobs:
  xcrypto-lookup:
    runs-on: ubuntu-latest
    env:
      SHELL: /bin/bash

    steps:
      - name: Install the JQ package
        run: sudo apt-get install jq -y

      - name: Clone the telco-bot repository
        uses: actions/checkout@v6

      - name: Check if XCRYPTO_LOOKUP_GITHUB_TOKEN secret exists
        run: |
          if [ -z "${{ secrets.XCRYPTO_LOOKUP_GITHUB_TOKEN }}" ]; then
            echo "Error: XCRYPTO_LOOKUP_GITHUB_TOKEN secret is not set."
            exit 1
          fi

      - name: Login to gh cli tool
        run: echo "$XCRYPTO_GITHUB_TOKEN" | gh auth login --with-token
        env:
          XCRYPTO_GITHUB_TOKEN: ${{ secrets.XCRYPTO_LOOKUP_GITHUB_TOKEN }}

      - name: Run the xcrypto-lookup script
        run: |
          echo "Running xcrypto-lookup script (daily update with issue management, no Slack notification)"
          ./scripts/xcrypto-lookup.sh --create-issues

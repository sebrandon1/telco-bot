name: Go Version Checker - Daily Update

on:
  schedule:
    # Run daily at 6:00 AM UTC (1:00 AM EST / 2:00 AM EDT)
    - cron: '0 6 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  check-go-versions:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
      
      - name: Set up Go
        uses: actions/setup-go@v6
        with:
          go-version-file: 'go.mod'
      
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq
      
      - name: Run Go version checker
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Make script executable
          chmod +x scripts/go-version-checker.sh
          
          # Run without --create-issues flag to only update tracking issue
          ./scripts/go-version-checker.sh
      
      - name: Upload report as artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: go-version-report
          path: |
            .go-version-checker*.cache
          retention-days: 7

